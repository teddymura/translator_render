<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Translator with edge-tts</title>
<style>
body { font-family: sans-serif; padding: 10px; max-width: 600px; margin: auto; }
input, select, button { font-size: 1em; margin: 5px 0; width: 100%; padding: 8px; }
audio { width: 100%; margin-top: 10px; }
</style>
</head>
<body>
<h2>テキスト翻訳 & 音声再生</h2>

<form id="textForm">
  <input type="text" id="textInput" placeholder="翻訳するテキスト">
  <select id="targetLang">
    <option value="en">英語</option>
    <option value="ja">日本語</option>
    <option value="fr">フランス語</option>
    <option value="de">ドイツ語</option>
    <option value="zh-cn">中国語(簡体)</option>
    <option value="zh-tw">中国語(繁体)</option>
    <option value="es">スペイン語</option>
    <option value="ko">韓国語</option>
  </select>
  <button type="submit">翻訳 + 音声再生</button>
</form>

<p id="translatedText"></p>
<audio id="audioPlayer" controls></audio>

<script>
document.getElementById("textForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const text = document.getElementById("textInput").value;
  const lang = document.getElementById("targetLang").value;
  const result = document.getElementById("translatedText");
  const audio = document.getElementById("audioPlayer");

  result.textContent = "翻訳中…";

  try {
    const formData = new FormData();
    formData.append("text", text);
    formData.append("target_lang", lang);

    const response = await fetch("/api/translate_tts", {
      method: "POST",
      body: formData
    });

    const data = await response.json();

    if(data.error){
      result.textContent = "エラー: " + data.error;
      audio.src = "";
    } else {
      result.textContent = "翻訳: " + data.translated_text;
      audio.src = data.audio_file;
      audio.play();
    }
  } catch(err){
    result.textContent = "通信エラー: " + err;
    audio.src = "";
  }
});
</script>

</body>
</html>
